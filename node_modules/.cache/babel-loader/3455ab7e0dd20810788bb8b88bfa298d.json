{"ast":null,"code":"const connection = require('../database/connections');\n\nconst index = require('./OngsControllers');\n\nmodule.exports = {\n  async index(request, response) {\n    const incidents = await connection('incidents').select('*');\n    return response.json(incidents);\n  },\n\n  async create(request, response) {\n    const {\n      title,\n      description,\n      value\n    } = request.body;\n    const ong_id = request.headers.authorization;\n    const [id] = await connection('incidents').insert({\n      title,\n      description,\n      value,\n      ong_id\n    });\n    return response.json({\n      id\n    });\n  },\n\n  async delete(request, response) {\n    const {\n      id\n    } = request.params;\n    const ong_id = request.headers.authorization;\n    const incident = await connection('incidents').where('id', id).select('ong_id').first();\n\n    if (incident.ong_id != ong_id) {\n      return response.status(401).json({\n        error: 'Operation not permitted.'\n      });\n    }\n\n    await connection('incidents').where('id', id).delete();\n    return response.status(204).send();\n  }\n\n};","map":{"version":3,"sources":["/home/rosiane/back/src/controllers/IncidentController.js"],"names":["connection","require","index","module","exports","request","response","incidents","select","json","create","title","description","value","body","ong_id","headers","authorization","id","insert","delete","params","incident","where","first","status","error","send"],"mappings":"AAAA,MAAMA,UAAU,GAAGC,OAAO,CAAC,yBAAD,CAA1B;;AACA,MAAMC,KAAK,GAAID,OAAO,CAAC,mBAAD,CAAtB;;AAEAE,MAAM,CAACC,OAAP,GAAiB;AAEb,QAAMF,KAAN,CAAYG,OAAZ,EAAqBC,QAArB,EAA+B;AAC3B,UAAMC,SAAS,GAAG,MAAMP,UAAU,CAAC,WAAD,CAAV,CAAwBQ,MAAxB,CAA+B,GAA/B,CAAxB;AAEA,WAAOF,QAAQ,CAACG,IAAT,CAAcF,SAAd,CAAP;AACH,GANY;;AAOb,QAAMG,MAAN,CAAaL,OAAb,EAAsBC,QAAtB,EAA+B;AAC3B,UAAM;AAAEK,MAAAA,KAAF;AAASC,MAAAA,WAAT;AAAsBC,MAAAA;AAAtB,QAA+BR,OAAO,CAACS,IAA7C;AACA,UAAMC,MAAM,GAAGV,OAAO,CAACW,OAAR,CAAgBC,aAA/B;AAEA,UAAM,CAACC,EAAD,IAAO,MAAMlB,UAAU,CAAE,WAAF,CAAV,CAAyBmB,MAAzB,CAAgC;AAC/CR,MAAAA,KAD+C;AAE/CC,MAAAA,WAF+C;AAG/CC,MAAAA,KAH+C;AAI/CE,MAAAA;AAJ+C,KAAhC,CAAnB;AAMA,WAAOT,QAAQ,CAACG,IAAT,CAAc;AAAES,MAAAA;AAAF,KAAd,CAAP;AACH,GAlBY;;AAmBb,QAAME,MAAN,CAAaf,OAAb,EAAsBC,QAAtB,EAA+B;AAC3B,UAAM;AAAEY,MAAAA;AAAF,QAASb,OAAO,CAACgB,MAAvB;AACA,UAAMN,MAAM,GAAGV,OAAO,CAACW,OAAR,CAAgBC,aAA/B;AAEA,UAAMK,QAAQ,GAAG,MAAMtB,UAAU,CAAC,WAAD,CAAV,CACtBuB,KADsB,CAChB,IADgB,EACVL,EADU,EAEtBV,MAFsB,CAEf,QAFe,EAGtBgB,KAHsB,EAAvB;;AAKA,QAAIF,QAAQ,CAACP,MAAT,IAAmBA,MAAvB,EAA+B;AAC3B,aAAOT,QAAQ,CAACmB,MAAT,CAAgB,GAAhB,EAAqBhB,IAArB,CAA0B;AAAEiB,QAAAA,KAAK,EAAE;AAAT,OAA1B,CAAP;AAEH;;AACD,UAAM1B,UAAU,CAAC,WAAD,CAAV,CAAwBuB,KAAxB,CAA8B,IAA9B,EAAoCL,EAApC,EAAwCE,MAAxC,EAAN;AAEA,WAAOd,QAAQ,CAACmB,MAAT,CAAgB,GAAhB,EAAqBE,IAArB,EAAP;AAEH;;AApCY,CAAjB","sourcesContent":["const connection = require('../database/connections');\nconst index  = require('./OngsControllers');\n\nmodule.exports = {\n\n    async index(request, response) {\n        const incidents = await connection('incidents').select('*');\n\n        return response.json(incidents);\n    },\n    async create(request, response){\n        const { title, description, value} = request.body;\n        const ong_id = request.headers.authorization;\n\n        const [id] = await connection ('incidents').insert({\n            title,\n            description,\n            value,\n            ong_id,\n        });\n        return response.json({ id });\n    },\n    async delete(request, response){\n        const { id } = request.params;\n        const ong_id = request.headers.authorization;\n\n        const incident = await connection('incidents')\n        .where('id', id)\n        .select('ong_id')\n        .first();\n\n        if (incident.ong_id != ong_id) {\n            return response.status(401).json({ error: 'Operation not permitted.'});\n\n        }\n        await connection('incidents').where('id', id).delete();\n\n        return response.status(204).send();\n\n    }\n};"]},"metadata":{},"sourceType":"module"}