{"ast":null,"code":"const Transaction = require('../../execution/transaction');\n\nconst Debug = require('debug');\n\nconst debug = Debug('knex:tx');\n\nclass Transaction_MySQL extends Transaction {\n  query(conn, sql, status, value) {\n    const t = this;\n    const q = this.trxClient.query(conn, sql).catch(err => {\n      if (err.errno === 1305) {\n        this.trxClient.logger.warn('Transaction was implicitly committed, do not mix transactions and ' + 'DDL with MySQL (#805)');\n        return;\n      }\n\n      status = 2;\n      value = err;\n      t._completed = true;\n      debug('%s error running transaction query', t.txid);\n    }).then(function (res) {\n      if (status === 1) t._resolver(value);\n\n      if (status === 2) {\n        if (value === undefined) {\n          if (t.doNotRejectOnRollback && /^ROLLBACK\\b/i.test(sql)) {\n            t._resolver();\n\n            return;\n          }\n\n          value = new Error(`Transaction rejected with non-error: ${value}`);\n        }\n\n        t._rejecter(value);\n      }\n\n      return res;\n    });\n\n    if (status === 1 || status === 2) {\n      t._completed = true;\n    }\n\n    return q;\n  }\n\n}\n\nmodule.exports = Transaction_MySQL;","map":{"version":3,"sources":["/home/rosiane/Projeto-completo/back/node_modules/knex/lib/dialects/mysql/transaction.js"],"names":["Transaction","require","Debug","debug","Transaction_MySQL","query","conn","sql","status","value","t","q","trxClient","catch","err","errno","logger","warn","_completed","txid","then","res","_resolver","undefined","doNotRejectOnRollback","test","Error","_rejecter","module","exports"],"mappings":"AAAA,MAAMA,WAAW,GAAGC,OAAO,CAAC,6BAAD,CAA3B;;AACA,MAAMC,KAAK,GAAGD,OAAO,CAAC,OAAD,CAArB;;AAEA,MAAME,KAAK,GAAGD,KAAK,CAAC,SAAD,CAAnB;;AAEA,MAAME,iBAAN,SAAgCJ,WAAhC,CAA4C;AAC1CK,EAAAA,KAAK,CAACC,IAAD,EAAOC,GAAP,EAAYC,MAAZ,EAAoBC,KAApB,EAA2B;AAC9B,UAAMC,CAAC,GAAG,IAAV;AACA,UAAMC,CAAC,GAAG,KAAKC,SAAL,CACPP,KADO,CACDC,IADC,EACKC,GADL,EAEPM,KAFO,CAEAC,GAAD,IAAS;AACd,UAAIA,GAAG,CAACC,KAAJ,KAAc,IAAlB,EAAwB;AACtB,aAAKH,SAAL,CAAeI,MAAf,CAAsBC,IAAtB,CACE,uEACE,uBAFJ;AAIA;AACD;;AAEDT,MAAAA,MAAM,GAAG,CAAT;AACAC,MAAAA,KAAK,GAAGK,GAAR;AACAJ,MAAAA,CAAC,CAACQ,UAAF,GAAe,IAAf;AACAf,MAAAA,KAAK,CAAC,oCAAD,EAAuCO,CAAC,CAACS,IAAzC,CAAL;AACD,KAfO,EAgBPC,IAhBO,CAgBF,UAAUC,GAAV,EAAe;AACnB,UAAIb,MAAM,KAAK,CAAf,EAAkBE,CAAC,CAACY,SAAF,CAAYb,KAAZ;;AAClB,UAAID,MAAM,KAAK,CAAf,EAAkB;AAChB,YAAIC,KAAK,KAAKc,SAAd,EAAyB;AACvB,cAAIb,CAAC,CAACc,qBAAF,IAA2B,eAAeC,IAAf,CAAoBlB,GAApB,CAA/B,EAAyD;AACvDG,YAAAA,CAAC,CAACY,SAAF;;AACA;AACD;;AACDb,UAAAA,KAAK,GAAG,IAAIiB,KAAJ,CAAW,wCAAuCjB,KAAM,EAAxD,CAAR;AACD;;AACDC,QAAAA,CAAC,CAACiB,SAAF,CAAYlB,KAAZ;AACD;;AACD,aAAOY,GAAP;AACD,KA7BO,CAAV;;AA8BA,QAAIb,MAAM,KAAK,CAAX,IAAgBA,MAAM,KAAK,CAA/B,EAAkC;AAChCE,MAAAA,CAAC,CAACQ,UAAF,GAAe,IAAf;AACD;;AACD,WAAOP,CAAP;AACD;;AArCyC;;AAwC5CiB,MAAM,CAACC,OAAP,GAAiBzB,iBAAjB","sourcesContent":["const Transaction = require('../../execution/transaction');\nconst Debug = require('debug');\n\nconst debug = Debug('knex:tx');\n\nclass Transaction_MySQL extends Transaction {\n  query(conn, sql, status, value) {\n    const t = this;\n    const q = this.trxClient\n      .query(conn, sql)\n      .catch((err) => {\n        if (err.errno === 1305) {\n          this.trxClient.logger.warn(\n            'Transaction was implicitly committed, do not mix transactions and ' +\n              'DDL with MySQL (#805)'\n          );\n          return;\n        }\n\n        status = 2;\n        value = err;\n        t._completed = true;\n        debug('%s error running transaction query', t.txid);\n      })\n      .then(function (res) {\n        if (status === 1) t._resolver(value);\n        if (status === 2) {\n          if (value === undefined) {\n            if (t.doNotRejectOnRollback && /^ROLLBACK\\b/i.test(sql)) {\n              t._resolver();\n              return;\n            }\n            value = new Error(`Transaction rejected with non-error: ${value}`);\n          }\n          t._rejecter(value);\n        }\n        return res;\n      });\n    if (status === 1 || status === 2) {\n      t._completed = true;\n    }\n    return q;\n  }\n}\n\nmodule.exports = Transaction_MySQL;\n"]},"metadata":{},"sourceType":"script"}